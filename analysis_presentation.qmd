---
title: "熱交換器詰まり分析の概要"
subtitle: "Analysis Workflow Explanation"
author: "Analysis Team"
format: revealjs
editor: visual
lang: ja
---

## 分析の目的

**熱交換器の詰まり要因の特定**

- **ターゲット:** 詰まり本数 (NoS: Number of Stuck Tubes)
- **説明変数:** 運転パラメータ
  - U値 (U-Value) -> UA (総括伝熱係数 × 伝熱面積)
  - ジャケット圧 (Jacket Pressure)
  - ポンプ吐出圧 (Pump Outlet Pressure)

これらパラメータと詰まり本数の相関関係を分析します。

## 使用データ

入力データは以下のExcelファイルを使用しています (`data/` ディレクトリ)。

1.  **時系列プロセスデータ** (`20251210_u_value.xlsx`)
    - U値, ジャケット圧, ポンプ圧などのタイムスタンプ付きデータ
    - 2021年2月以降のデータを対象

2.  **詰まり本数データ** (`NoS_20251201.xlsx`)
    - キャンペーンごとの詰まり本数 (NoS)
    - 初期 (Beginning) / 末期 (End) の区分

## 分析フロー概要

1.  **データ読み込み & 前処理**
2.  **時系列トレンド可視化** (Dygraphs)
3.  **特徴量抽出** (キャンペーンごとの最大値)
4.  **相関分析 & 回帰モデル作成**
    - 時期別比較 (2021年9月 前/後)
5.  **乖離幅 (Deviation) の評価**

## 前処理ロジック

### 1. 特徴量の抽出 (`get_campaign_max`)
キャンペーンの「初期」および「末期」における各パラメータの最大値を抽出します。
- **End:** キャンペーン終了前の1ヶ月間
- **Beginning:** キャンペーン開始後の1ヶ月間

### 2. 時期による区分 (`Time_Category`)
データの傾向変化を考慮し、**2021年9月 (2021-10-01)** を境界としてデータを2つに分割して分析します。
- `Before Sep 2021`
- `After Sep 2021`

## 可視化: トレンド監視

インタラクティブな時系列グラフ (`dygraphs`) を用いて、各パラメータの挙動を確認します。

- **U値:** 青色 (Blue)
- **ジャケット圧:** 緑色 (Green)
- **ポンプ圧:** 赤色 (Red)

欠損値を除去した上で `xts` オブジェクトに変換して描画しています。

## 分析ケース詳細

以下の3つのケースについて相関を評価します。

- **Case 1: UA**
  - U値の最大値に対し、係数 **367** を乗じてUAを算出
- **Case 2: ジャケット圧**
  - `jacket_P` の最大値を使用
- **Case 3: ポンプ圧**
  - `pump_outlet` の最大値を使用

## 評価指標: 乖離幅 (Deviation)

回帰直線からの**残差 (Residuals)** を計算し、予測モデルからの乖離を評価します。

- **最大乖離幅 (Max Deviation):**
  - 各時期区分における残差の絶対値の最大値
- **全体に対する割合:**
  - 全チューブ本数 **922本** に対する割合 (%)
  - $\frac{\text{Max Deviation}}{922} \times 100$

## 出力レポート

分析結果は `Analysis_1st.html` として出力されます。

- 散布図 (Scatter Plot) + 回帰直線
- 相関係数 (Pearson)
- 時期ごとの乖離幅統計テーブル

このレポートにより、運転パラメータと詰まりリスクの関係性を定量的に把握します。
